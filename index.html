<!DOCTYPE html>
<html lang="id">
<head>
  <!-- Bagian head tetap sama seperti sebelumnya -->
  <style>
    /* Tambahkan style untuk tampilan nama siswa terpilih */
    .selected-student {
      background-color: rgba(74, 156, 95, 0.15);
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .selected-student i {
      font-size: 1.8rem;
      color: var(--accent);
    }
    
    .selected-student .student-info {
      flex-grow: 1;
    }
    
    .selected-student .student-name {
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--primary);
    }
    
    .selected-student .student-class {
      color: var(--secondary);
      font-size: 1rem;
    }
    
    .btn-change {
      background: linear-gradient(to right, var(--warning), #e67e22);
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      white-space: nowrap;
    }
    
    .btn-change:hover {
      background: linear-gradient(to right, #e67e22, var(--warning));
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header tetap sama -->
    
    <div class="content">
      <!-- Bagian scanner tetap sama -->
      
      <div class="section-title">
        <i class="fas fa-edit"></i> Form Keterlambatan
      </div>
      
      <!-- TAMBAHKAN BAGIAN INI UNTUK MENAMPILKAN SISWA TERPILIH -->
      <div id="selected-student-container" class="hidden">
        <div class="selected-student">
          <i class="fas fa-user-graduate"></i>
          <div class="student-info">
            <div class="student-name" id="selected-student-name"></div>
            <div class="student-class" id="selected-student-class"></div>
          </div>
          <button class="btn-change" id="change-student-btn">
            <i class="fas fa-sync-alt"></i> Ganti Siswa
          </button>
        </div>
      </div>
      
      <form id="form-keterlambatan">
        <!-- Formulir tetap sama -->
      </form>
      
      <!-- Bagian rekap dan respon tetap sama -->
    </div>
    
    <!-- Footer tetap sama -->
  </div>

  <script>
    // Tambahkan variabel baru
    const selectedStudentContainer = document.getElementById("selected-student-container");
    const selectedStudentName = document.getElementById("selected-student-name");
    const selectedStudentClass = document.getElementById("selected-student-class");
    const changeStudentBtn = document.getElementById("change-student-btn");
    const namaInput = document.getElementById("nama");
    
    // Fungsi untuk menampilkan siswa terpilih
    function showSelectedStudent(nama, kelas) {
      selectedStudentName.textContent = nama;
      selectedStudentClass.textContent = "Kelas: " + kelas;
      selectedStudentContainer.classList.remove("hidden");
      namaInput.disabled = true; // Nonaktifkan input nama saat sudah dipilih
    }
    
    // Fungsi untuk menyembunyikan siswa terpilih
    function hideSelectedStudent() {
      selectedStudentContainer.classList.add("hidden");
      namaInput.disabled = false; // Aktifkan kembali input nama
      namaInput.value = "";
      namaInput.focus();
      document.getElementById("kelas").value = "";
      rekap.textContent = "";
    }
    
    // Event listener untuk tombol ganti siswa
    changeStudentBtn.addEventListener("click", function(e) {
      e.preventDefault();
      hideSelectedStudent();
    });
    
    // Modifikasi event listener input nama
    document.getElementById("nama").addEventListener("input", function () {
      const inputNama = this.value;
      const ditemukan = semuaSiswa.find(s => s.nama === inputNama);
      if (ditemukan) {
        document.getElementById("kelas").value = ditemukan.kelas || "";
        showSelectedStudent(ditemukan.nama, ditemukan.kelas);
        
        // ... kode rekap yang sudah ada ...
      } else {
        hideSelectedStudent();
      }
    });
    
    // Modifikasi fungsi untuk scan QR
    function mulaiScan() {
      // ... kode yang sudah ada ...
      
      html5QrCode.start(
        kameraBelakang.id,
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          namaInput.value = qrCodeMessage;
          namaInput.dispatchEvent(new Event("input"));
          
          // ... kode yang sudah ada ...
        },
        // ... kode yang sudah ada ...
      );
    }
    
    // Modifikasi form submit
    form.addEventListener("submit", function(e) {
      e.preventDefault();
      
      // ... kode yang sudah ada ...
      
      // Setelah sukses mengirim
      showSuccessFeedback("âœ… " + text);
      form.reset();
      hideSelectedStudent(); // Tambahkan ini
      
      // ... kode yang sudah ada ...
    });
  </script>
</body>
</html>
