<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Keterlambatan Siswa</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f5;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    form {
      background: #fff;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      background-color: #007bff;
      border: none;
      color: white;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .message {
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }
    .message.success {
      color: green;
    }
    .message.error {
      color: red;
    }
    .hidden {
      display: none;
    }
    #selected-student {
      background: #e0f7fa;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>Form Keterlambatan Siswa</h1>

<form id="lateForm">
  <label for="nama">Nama Siswa</label>
  <input type="text" id="nama" name="nama" list="daftar-nama" placeholder="Ketik nama siswa..." required />

  <datalist id="daftar-nama">
    <option value="ADIBA ADZKIA INARA" data-kelas="7A">
    <option value="ALYA AMIRA FAKHIRA" data-kelas="7A">
    <option value="ILHAM RAIHAN" data-kelas="7B">
    <!-- Tambahkan nama lainnya -->
  </datalist>

  <div id="selected-student" class="hidden">
    <p><strong id="selected-name"></strong></p>
    <p id="selected-kelas"></p>
    <button type="button" onclick="hapusPilihan()">Ganti Siswa</button>
  </div>

  <label for="kelas">Kelas</label>
  <input type="text" name="kelas" id="kelas" placeholder="Contoh: 7A" required />

  <label for="tanggal">Tanggal</label>
  <input type="date" name="tanggal" id="tanggal" required />

  <label for="waktu">Waktu Datang</label>
  <input type="time" name="waktu" id="waktu" required />

  <label for="alasan">Alasan Keterlambatan</label>
  <textarea name="alasan" id="alasan" rows="3" required></textarea>

  <button type="submit">Kirim</button>

  <div id="message" class="message hidden"></div>
</form>

<script>
  const form = document.getElementById("lateForm");
  const namaInput = document.getElementById("nama");
  const kelasInput = document.getElementById("kelas");
  const selectedStudentContainer = document.getElementById("selected-student");
  const selectedStudentName = document.getElementById("selected-name");
  const selectedStudentClass = document.getElementById("selected-kelas");
  const messageBox = document.getElementById("message");

  namaInput.addEventListener("change", () => {
    const nama = namaInput.value.trim();
    const option = [...document.querySelectorAll("#daftar-nama option")].find(o => o.value === nama);
    if (option) {
      const kelas = option.dataset.kelas || "";
      showSelectedStudent(nama, kelas);
    }
  });

  function showSelectedStudent(nama, kelas) {
    selectedStudentName.textContent = nama;
    selectedStudentClass.textContent = "Kelas: " + (kelas || "-");
    selectedStudentContainer.classList.remove("hidden");

    namaInput.value = nama;
    namaInput.readOnly = true;
    kelasInput.value = kelas;
  }

  function hapusPilihan() {
    selectedStudentContainer.classList.add("hidden");
    namaInput.readOnly = false;
    namaInput.value = "";
    kelasInput.value = "";
    namaInput.focus();
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const nama = formData.get("nama");
    const tanggal = formData.get("tanggal");

    if (!nama || !tanggal) {
      tampilkanPesan("❌ Nama dan tanggal wajib diisi.", "error");
      return;
    }

    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbw0p7ELOZDe9NIsuw7r9FY2EQDFeSxyS2znNwQyW5dOloVX1Z0Y1Y9PWLsOiC4dJ9oF/exec", {
        method: "POST",
        body: formData,
      });

      const result = await response.json();

      if (result.success) {
        tampilkanPesan("✅ Data berhasil dikirim!", "success");
        form.reset();
        hapusPilihan();
      } else {
        tampilkanPesan("❌ Gagal mengirim data. Coba lagi.", "error");
      }
    } catch (error) {
      tampilkanPesan("❌ Terjadi kesalahan koneksi.", "error");
    }
  });

  function tampilkanPesan(teks, tipe) {
    messageBox.textContent = teks;
    messageBox.className = "message " + tipe;
    messageBox.classList.remove("hidden");
    setTimeout(() => {
      messageBox.classList.add("hidden");
    }, 5000);
  }
</script>

</body>
</html>