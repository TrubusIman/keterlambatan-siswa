<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORM KETERLAMBATAN SISWA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* [CSS tetap sama seperti sebelumnya] */
    </style>
</head>
<body>
    <!-- [HTML struktur tetap sama] -->

    <script>
        // [Kode JavaScript sebelumnya] 
        
        // Perbaikan utama pada bagian pengambilan data dan pencarian
        fetch(dataUrl)
            .then(res => res.json())
            .then(data => {
                // Pastikan data adalah array
                semuaSiswa = Array.isArray(data) ? data : [];
                console.log("Data siswa diterima:", semuaSiswa);
                
                // Event listener untuk pencarian siswa - DIPINDAHKAN ke sini
                cariSiswaInput.addEventListener("input", function() {
                    const query = this.value.toLowerCase().trim();
                    console.log("Pencarian:", query);
                    
                    if (query.length < 2) {
                        searchResults.style.display = "none";
                        return;
                    }
                    
                    const results = semuaSiswa.filter(student => 
                        student.nama && student.nama.toLowerCase().includes(query)
                    );
                    
                    console.log("Hasil pencarian:", results);
                    showSearchResults(results);
                });
                
                // Sembunyikan hasil pencarian ketika klik di luar
                document.addEventListener("click", function(e) {
                    if (!cariSiswaInput.contains(e.target) {
                        searchResults.style.display = "none";
                    }
                });
            })
            .catch(err => {
                console.error("Gagal mengambil data siswa:", err);
                showMessage("‚ùå Gagal mengambil data siswa. Coba lagi nanti.", "error");
            });

        // [Kode JavaScript lainnya tetap sama] 
    </script>
</body>
</html>